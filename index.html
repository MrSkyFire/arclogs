<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ARC Raiders – Field Logs</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { margin: 0; background: #000; color: #e6f2ff; font-family: system-ui, sans-serif; }
main { max-width: 900px; margin: auto; padding: 24px; }
h1 { color: #66ccff; letter-spacing: 0.2em; text-transform: uppercase; }
.log { border-left: 2px solid #66ccff; padding-left: 12px; margin-bottom: 22px; white-space: pre-wrap; }
.user { color: #8fdcff; font-size: 0.8rem; opacity: 0.85; }
.date { font-size: 0.7rem; opacity: 0.5; margin-bottom: 6px; }
form { margin-top: 40px; border-top: 1px solid #222; padding-top: 20px; }
input, textarea { width: 100%; background: #050505; color: #e6f2ff; border: 1px solid #333; padding: 10px; margin-bottom: 8px; }
button { background: #66ccff; color: #000; border: none; padding: 8px 16px; font-weight: bold; cursor: pointer; }
</style>
</head>
<body>
<main>
<h1>ARC Raiders – Field Logs</h1>
<section id="logs">Loading logs...</section>

<form id="submitLog">
<h2>Submit a Log</h2>
<input type="text" id="username" placeholder="Username (optional, e.g. scout#0001)">
<input type="date" id="date" placeholder="Date submitted (optional)">
<textarea id="logtext" rows="5" placeholder="Enter your log here"></textarea>
<button type="submit">Submit</button>
<p style="opacity:.4;font-size:.75rem">Logs are live — submissions go directly to logs.txt.</p>
</form>
</main>

<script>
// Load logs
function loadLogs() {
  fetch('/logs.txt')
    .then(r => r.text())
    .then(text => {
      const entries = text.split('\n---\n');
      const container = document.getElementById('logs');
      container.innerHTML = '';
      entries.reverse().forEach(entry => {
        if (!entry.trim()) return;
        const lines = entry.trim().split('\n');
        let user = null, date = null;
        if (lines[0].startsWith('@')) user = lines.shift().substring(1);
        if (lines[0] && lines[0].startsWith('[DATE:') && lines[0].endsWith(']')) date = lines.shift().slice(6,-1).trim();
        const div = document.createElement('div'); div.className='log';
        if(user){const u=document.createElement('div'); u.className='user'; u.textContent=user; div.appendChild(u);}
        if(date){const d=document.createElement('div'); d.className='date'; d.textContent='Submitted: '+date; div.appendChild(d);}
        div.appendChild(document.createTextNode(lines.join('\n')));
        container.appendChild(div);
      });
    })
    .catch(()=>document.getElementById('logs').textContent='Error loading logs.');
}
loadLogs();

// Handle submission
document.getElementById('submitLog').addEventListener('submit', function(e){
  e.preventDefault();
  const username=document.getElementById('username').value.trim();
  const date=document.getElementById('date').value;
  const text=document.getElementById('logtext').value.trim();
  if(!text) return alert("Log text cannot be empty.");
  fetch('/submit', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({username,date,text})
  })
  .then(res=>res.json())
  .then(res=>{
    if(res.success){loadLogs(); document.getElementById('submitLog').reset();}
    else alert('Submission failed: '+res.error);
  })
  .catch(err=>alert('Submission failed: '+err));
});
</script>
</body>
</html>
